{
  "issues": {
    "title": "Clinical Issues Extraction",
    "description": "Used to identify distinct clinical issues from the transcript",
    "prompt": "Read the clinical scenario below\nList the significant issues as brief, single-line statements. \nWhen multiple issues might be related by a clinical entity, combine them into one concise issue. \nEach issue must be 60 characters or fewer. \nPlease ensure the list of issues isn't numbered.\nPlease ensure there isn't a trailing full stop at the end of each issue\nPlease only generate 2-3 issues for most patients.\nFor complex patients, perhaps 5 issues, for very complex patients 7. \nUse medical words where possible. \n\nClinical Scenario:\n{{text}}"
  },
  "findRelevantGuidelinesWithProbability": {
    "title": "Guidelines Selection with Probability Assessment",
    "description": "Used to select and rank relevant guidelines with probability levels for a clinical scenario",
    "system_prompt": "You are a medical guidelines analyzer. Your task is to analyze the given medical case and identify which guidelines are most relevant. For each guideline, provide a relevance score between 0 and 1.",
    "prompt": "Medical Case:\n{{transcript}}\n\nAvailable Guidelines:\n{{guidelines}}\n\nPlease analyze the medical case and categorize the guidelines by relevance. For each guideline, provide a relevance score between 0 and 1. Format your response as follows:\n\n[ID] Title: Relevance\n\nFor example:\n[doc-123] Title: Hypertension Management: 0.95\n[doc-456] Title: Diabetes Care: 0.75"
  },
  "clinicalNote": {
    "title": "Clinical Note Generation",
    "description": "Used to generate the final clinical note",
    "prompt": "Please write a concise clinical note using medical terminology, based solely on the clinical transcript provided below. Do not invent or assume any details that are not explicitly mentioned in the transcript.\n\nThe output should be in 3 sectiions.\nThe first section should be a simple summary of the presentation in bullet points, each point on a new line, including age, presenting complaint(s), and if relevant things like previous pregnancies (or lack thereof) and BMI. \nThen there should be a newline, then the middle section should be describe each issue in detail with the appropriate context and the associated advice from the doctor.\nThen there should be a newline, then the plan: first write 'Plan:' and then, from a new line, a numbered list of the management steps anticipated\n\nRules:\n- Use professional medical terminology.\n- Use one sentence per line.\n- Only include details that are directly mentioned in the transcript\n\nClinical transcript:\n{{text}}\n"
  },
  "applyGuideline": {
    "title": "Apply Guideline to Clinical Situation",
    "description": "Used to apply a clinical guideline to a specific clinical situation",
    "prompt": "I would like you to apply the attached clinical guideline to the following clinical situation.\n\nYour response should include the following, where appropriate:\n1. Further information needed - list what additional information is needed and why\n2. Proposed management according to the guideline\n3. Benefits of the proposed approach\n4. Risks of the proposed approach\n5. Alternative approaches\n\nGuideline:\n{{guideline}}\n\nClinical situation:\n{{situation}}"
  },
  "testTranscript": {
    "title": "Test Transcript Generation",
    "description": "Used to generate fictional test transcripts for development and testing",
    "prompt": "Create a fictional dictation of a clinical interaction between a healthcare professional and a patient. \nThis dictation is for testing purposes only and should include various topics that might be discussed in a healthcare setting. \nPlease ensure the material is entirely fictional and does not provide any real medical advice or information. \nPlease ensure variables such as age, weight and history are varied.\nThe clinician should ensure the history and examination findings are incomplete, leaving out some pertinent questions.\nIn response to their history and examination findings, the clinician should  provide management advice and guidance.\nThe clinical scenario should be the following: "
  },
  "crossCheck": {
    "title": "Cross-Check Clinical Note Against Guidelines",
    "description": "Used to validate a clinical note against provided guidelines",
    "prompt": "You are provided with the text of a clinical note from a patient encounter and a set of clinical guidelines with their content. Your task is to:\n\n1. Cross-check the clinical note against each provided guideline and its content.\n2. Identify areas in the clinical note that do not fully adhere to the guideline recommendations.\n3. Note any parts of the note that could be improved based on the guidelines.\n4. Return ONLY the HTML-formatted clinical note with the suggested changes.\n\nThe clinical note should be output as valid HTML.\nAny text in the clinical note that has been adjusted or needs adjustment (in light of the guidelines) MUST be wrapped in <i></i> tags (to display in italics).\nImmediately after each italicized change, include the guideline reference in parentheses (e.g., guideline name or identifier).\n\nWhen making recommendations:\n- Be specific and base all recommendations directly on the guideline content provided\n- Apply appropriate clinical judgment to ensure recommendations are medically sound\n- Consider the patient's specific circumstances as described in the note\n\nVery important formatting rules:\n- ALL changes MUST be wrapped in <i> tags followed by the guideline reference\n- Make sure every single recommended change is properly marked with <i> tags\n- Do not leave any changes unmarked\n- Do not use any other formatting except <i> tags for changes\n\nDO NOT include any explanatory text, introduction, or conclusion in your response.\nDO NOT include the complete text of each guideline in your response.\nDO NOT use markdown or code formatting in your response.\nONLY return the modified clinical note in HTML format, with no additional commentary.\n\nHere is the note text: {{text}}\nHere is each guideline with its title and content:\n{{guidelines}}"
  },
  "checkGuidelineRelevance": {
    "title": "Check All Guidelines for Relevant Probability",
    "description": "Used to assess the probability of relevance for each guideline against a clinical note",
    "prompt": "I would like to know which of these clinical guidelines are likely to be relevant to this clinical scenario.\n\nIMPORTANT: You MUST use EXACTLY these probability levels for each guideline:\n- Certain (directly applicable to the main clinical issues and patient's specific context)\n- Highly Likely (closely related to the main clinical issues and patient's specific context)\n- Likely (potentially relevant to secondary issues or patient's specific context)\n- Unlikely (minimal relevance to the patient's specific context)\n- Not Relevant (no clear connection to the patient's specific context)\n\nPlease analyze the clinical note and provide a response in EXACTLY this format:\n\n### Most Relevant Guidelines\n[List guidelines marked as 'Certain' or 'Highly Likely', ordered by relevance]\n\n### Potentially Relevant Guidelines\n[List guidelines marked as 'Likely', ordered by relevance]\n\n### Less Relevant Guidelines\n[List guidelines marked as 'Unlikely', ordered by relevance]\n\n### Not Relevant Guidelines\n[List guidelines marked as 'Not Relevant']\n\nFor each guideline, use EXACTLY this format:\nGuideline Name: Probability of Relevance\n\nAssessment Criteria:\n1. Consider the patient's specific context (e.g., pregnancy status, age, comorbidities)\n2. Focus on guidelines that provide actionable recommendations for the patient's current situation\n3. Prioritize guidelines that address the primary clinical issues\n4. Consider guidelines that may be relevant for secondary issues or future management\n5. Be conservative in your assessment - only mark as 'Certain' if the guideline is directly applicable to the main clinical issues and patient's specific context\n\nIMPORTANT FORMATTING RULES:\n- Each guideline MUST be on a new line\n- Each guideline MUST follow the format: 'Guideline Name: Probability of Relevance'\n- The probability MUST be one of the five levels listed above\n- ALL guidelines MUST be listed, even if not relevant\n- Do not add any additional text or explanations\n\nClinical Note:\n{{text}}\n\nAvailable Guidelines:\n{{guidelines}}"
  },
  "guidelineRecommendations": {
    "title": "Analyze Note Against Guideline",
    "description": "Used to analyze a clinical note against a specific guideline and provide recommendations for improvement",
    "prompt": "Please analyze the clinical note against the provided guideline and suggest improvements to better align with the guideline recommendations.\n\nFor each recommendation, specify:\n1. The type of recommendation:\n   - Additional information needed (history/examination/investigations)\n   - Improved patient advice (options/statistics/patient information)\n   - Different management plan\n2. The specific recommendation\n3. The reason for the recommendation (referencing the guideline)\n\nCategorize each recommendation by importance:\n- Very Important: Critical for patient safety or guideline compliance\n- Somewhat Important: Significant for optimal care but not critical\n- Less Important: Would improve care but not essential\n- Unimportant: Minor suggestions that could be considered\n\nFormat the response as follows:\n\n### Very Important Recommendations\n[Type] - [Specific recommendation]\nReason: [Reference to guideline ID and relevant section]\n\n### Somewhat Important Recommendations\n[Type] - [Specific recommendation]\nReason: [Reference to guideline ID and relevant section]\n\n### Less Important Recommendations\n[Type] - [Specific recommendation]\nReason: [Reference to guideline ID and relevant section]\n\n### Unimportant Recommendations\n[Type] - [Specific recommendation]\nReason: [Reference to guideline ID and relevant section]\n\nClinical Note:\n{{text}}\n\nGuideline:\n[ID] {{id}}\nTitle: {{title}}\nContent: {{guideline}}"
  },
  "extractHumanFriendlyName": {
    "system_prompt": "You are a medical guideline metadata extractor. Your task is to extract a clear, human-readable title for a medical guideline or clinical protocol.",
    "prompt": "Extract a clear, human-readable title for this medical guideline or clinical protocol. Return ONLY the clean title without version numbers, dates, page numbers, or commentary.\n\nRules:\n- Remove version numbers (e.g., 'v14', 'Version 3')\n- Remove document codes in parentheses like (024), (025)\n- Remove date ranges like 'November 2025 - November 2028'\n- Remove page references like 'Page 1 of 42'\n- Keep the core descriptive title\n- For local hospital protocols, extract the main topic and any important subtopics\n- Maximum 80 characters\n\nExamples of correct outputs:\n- RCOG Green-Top Guideline No. 59 - Outpatient Hysteroscopy\n- NICE CG190 - Intrapartum Care\n- Clinical Risk Assessment - Schedule of Antenatal Care\n- Preterm Labour and Birth Management\n- Pyrexia in Labour and Sepsis Protocol\n- Pre-Labour Rupture of Membranes (Term and Pre-term)\n- Gestational Diabetes Management Pathway\n\nGuideline text:\n{{text}}\n\nExtract the title:"
  },
  "extractOrganisation": {
    "system_prompt": "You are a medical guideline metadata extractor. Your task is to identify the organization that published a medical guideline.",
    "prompt": "Identify the organization that published this medical guideline. Return ONLY the organization name.\n\nExamples of correct outputs:\n- RCOG\n- NICE\n- ACOG\n- WHO\n- ESHRE\n- SOGC\n- Royal College of Obstetricians and Gynaecologists\n\nGuideline text:\n{{text}}\n\nPublishing organization:"
  },
  "extractYear": {
    "system_prompt": "You are a medical guideline metadata extractor. Your task is to find the year a medical guideline was published.",
    "prompt": "Find the year this medical guideline was published or last updated. Return ONLY the 4-digit year.\n\nExamples of correct outputs:\n- 2023\n- 2022\n- 2021\n\nGuideline text:\n{{text}}\n\nPublication year:"
  },
  "extractDOI": {
    "system_prompt": "You are a medical guideline metadata extractor. Your task is to find the DOI of a medical guideline.",
    "prompt": "Find the DOI (Digital Object Identifier) for this medical guideline. Return ONLY the DOI or 'Not available' if no DOI is found.\n\nExamples of correct outputs:\n- 10.1111/1471-0528.17234\n- 10.1016/j.ajog.2023.02.011\n- Not available\n\nGuideline text:\n{{text}}\n\nDOI:"
  },
  "extractSummary": {
    "system_prompt": "You are a medical guideline summarizer. Your task is to create a concise summary of a medical guideline.",
    "prompt": "Create a concise, clinical summary of this medical guideline in 2-3 sentences. Focus on the main purpose, key recommendations, and target population.\n\nExample format:\n'This guideline provides evidence-based recommendations for [condition/procedure] in [population]. Key recommendations include [main points]. It is intended for use by [healthcare professionals] in [setting].'\n\nGuideline text:\n{{text}}\n\nSummary:"
  },
  "extractKeywords": {
    "system_prompt": "You are a medical guideline keyword extractor. Your task is to identify the most relevant clinical keywords from a medical guideline.",
    "prompt": "Extract 5-10 relevant clinical keywords from this medical guideline. Focus on medical conditions, procedures, patient populations, and key clinical concepts. Return as a comma-separated list.\n\nExamples of good keywords:\n- pregnancy, hypertension, preeclampsia, blood pressure monitoring\n- caesarean section, surgical delivery, postoperative care\n- diabetes, insulin therapy, glucose monitoring, pregnancy\n\nGuideline text:\n{{text}}\n\nKeywords:"
  },
  "extractDisplayName": {
    "system_prompt": "You are a medical guideline display name generator. Return ONLY the final display name as plain text on a SINGLE LINE. No explanations. No reasoning. No markdown. No code fences.",
    "prompt": "Create a formatted display name for this medical guideline following this exact format:\n\nFORMAT: name (year) - region - trust\n\nOUTPUT RULES (CRITICAL):\n- Return ONLY the final display name.\n- SINGLE LINE plain text.\n- NO markdown, NO bullet points, NO headings, NO code fences, NO quotes.\n\nCRITICAL RULES:\n1. NAME PART:\n   - Remove all codes and reference numbers (CG1103, MP001, GP001, CG12029, UHS-CG-0009-2023, etc.)\n   - Remove version numbers (v2.0, V2, v0.0.1, V7, etc.)\n   - Remove partial dates from the name (keep only the year in parentheses)\n   - Keep organization names that are part of the official name (SECAmb, RCOG, NICE, FSRH, BASHH, WHO, etc.)\n   - Keep prefixes like 'UHSx', 'UHS', 'UHSussex' ONLY if they are part of the official guideline name\n   - Remove redundant words like 'guideline', 'protocol', 'SOP', 'policy' if they appear multiple times\n   - Use proper Title Case (capitalize first letter of each major word, lowercase articles/prepositions)\n   - PRESERVE ALL ACRONYMS IN ALL CAPS (RCOG, NICE, FSRH, BASHH, UKMEC, COCP, POP, PID, HIV, VTE, CTG, PPH, VBAC, CS, IOL, PCEA, etc.)\n\n2. YEAR PART:\n   - Extract the publication year from dates like '2020-10', '2020', 'June 2011', 'JULY 19', etc.\n   - Format as (year) in parentheses, e.g., (2020), (2011), (2023)\n   - If no year is found, omit the year part entirely\n\n3. REGION PART:\n   - Use 'Local' for local guidelines\n   - Use 'National' for national guidelines\n   - This comes from the guideline's scope metadata\n\n4. TRUST PART:\n   - For LOCAL guidelines: Use the abbreviated trust name provided in shortHospitalTrust\n   - For NATIONAL guidelines: Omit the trust part entirely\n   - The shortHospitalTrust field contains the pre-defined abbreviation (e.g., 'UHSussex', 'GSTT', 'KCH')\n\n5. FINAL FORMAT:\n   - Local: 'name (year) - Local - shortHospitalTrust'\n   - National: 'name (year) - National'\n   - If no year: 'name - Local - shortHospitalTrust' or 'name - National'\n\nExamples:\n- Input: title='CG1103 Antenatal Care & Patient Info', scope='local', shortHospitalTrust='UHSussex'\n  Output: Antenatal Care & Patient Info - Local - UHSussex\n\n- Input: title='2020-10 SECAmb Suspected Preterm Labour Guidance v0.0.1', scope='local', shortHospitalTrust='UHSussex'\n  Output: SECAmb Suspected Preterm Labour Guidance (2020) - Local - UHSussex\n\n- Input: title='NICE - 2023 - Hypertension In Pregnancy', scope='national', shortHospitalTrust=''\n  Output: NICE - Hypertension In Pregnancy (2023) - National\n\n- Input: title='RCOG Green-Top Guideline No. 59 - Outpatient Hysteroscopy', scope='national', shortHospitalTrust=''\n  Output: RCOG Green-Top Guideline No. 59 - Outpatient Hysteroscopy - National\n\nGuideline title: {{title}}\nGuideline scope: {{scope}}\nGuideline trust (abbreviated): {{shortHospitalTrust}}\nGuideline text (first 2000 characters):\n{{text}}\n\nDisplay name:"
  },
  "extractPublisherType": {
    "system_prompt": "You are a medical guideline metadata extractor. Your task is to determine whether a medical guideline was published by a national organization or a local hospital trust.",
    "prompt": "Determine whether this medical guideline was published by a national organization or a local hospital trust. Return ONLY 'national' or 'local'.\n\nNational organizations include:\n- NICE, RCOG, ACOG, WHO, ESHRE, FIGO, SIGN (Scotland), RCGPs, professional colleges, national health bodies\n\nLocal organizations include:\n- Individual NHS Foundation Trusts, Hospital Trusts, Health Boards, specific hospital trusts\n\nGuideline text:\n{{text}}\n\nPublisher type (national or local):"
  },
  "extractNation": {
    "system_prompt": "You are a medical guideline metadata extractor. Your task is to determine which nation a national guideline applies to.",
    "prompt": "Determine which nation this national medical guideline applies to. Return ONLY one of: 'England & Wales', 'Scotland', or 'Northern Ireland'.\n\nCRITICAL ORGANIZATION-TO-NATION MAPPING:\n- SIGN (Scottish Intercollegiate Guidelines Network) = Scotland ONLY\n- NICE (National Institute for Health and Care Excellence) = England & Wales ONLY\n- RCOG (Royal College of Obstetricians and Gynaecologists) = UK-wide, default to 'England & Wales'\n- GTG (Green-top Guidelines, published by RCOG) = UK-wide, default to 'England & Wales'\n- BJOG (British Journal of Obstetrics and Gynaecology) = UK-wide journal, default to 'England & Wales'\n- BASHH, FSRH, BHIVA, BAPM, BSH, WHO = UK-wide or international, default to 'England & Wales'\n\nIMPORTANT RULES:\n1. The publishing organization is the PRIMARY indicator. Use the mapping above.\n2. Mentions of Scotland in the text (e.g., 'studies in Scotland', 'Scottish contributors', 'Healthcare Improvement Scotland') do NOT make a guideline Scotland-specific.\n3. Only return 'Scotland' if the guideline is published by SIGN or explicitly states it is Scotland-only.\n4. Only return 'Northern Ireland' if explicitly stated.\n5. For UK-wide organizations (RCOG, BJOG, GTG), default to 'England & Wales'.\n6. When in doubt, default to 'England & Wales'.\n\nGuideline text:\n{{text}}\n\nNation:"
  },
  "extractHospitalTrust": {
    "system_prompt": "You are a medical guideline metadata extractor. Your task is to identify the full name of the hospital trust that published a local guideline.",
    "prompt": "Identify the full official name of the hospital trust that published this local medical guideline. Return ONLY the complete trust name.\n\nExamples of correct outputs:\n- University Hospitals Sussex NHS Foundation Trust\n- Guy's and St Thomas' NHS Foundation Trust\n- King's College Hospital NHS Foundation Trust\n- NHS Foundation Trust (if the full name cannot be determined from the text)\n\nLook for:\n- Trust names in headers, footers, or title pages\n- References to specific hospitals or trusts\n- Organizational names that indicate a specific hospital trust\n\nIf the trust name cannot be determined from the guideline text, return 'Not available'.\n\nGuideline text:\n{{text}}\n\nHospital Trust name:"
  },
  "analyzeGuidelineCompliance": {
    "system_prompt": "You are a medical guidelines compliance checker. Your task is to analyze if the given medical case follows the specified guideline. Provide a detailed analysis and specific recommendations if the case doesn't comply.",
    "prompt": "Medical Case:\n{{transcript}}\n\nGuideline:\n[ID] {{id}}\nTitle: {{title}}\nContent: {{content}}"
  },
  "analyzeClinicalNote": {
    "system_prompt": "You are a medical guidelines compliance checker. Your task is to analyze if the given clinical note follows the specified guideline and suggest improvements.",
    "prompt": "Please analyze the clinical note against the provided guideline and suggest improvements to better align with the guideline recommendations.\n\nFor each recommendation, specify:\n1. The type of recommendation:\n   - Additional information needed (history/examination/investigations)\n   - Improved patient advice (options/statistics/patient information)\n   - Different management plan\n2. The specific recommendation\n3. The reason for the recommendation (referencing the guideline)\n\nCategorize each recommendation by importance:\n- Very Important: Critical for patient safety or guideline compliance\n- Somewhat Important: Significant for optimal care but not critical\n- Less Important: Would improve care but not essential\n- Unimportant: Minor suggestions that could be considered\n\nFormat the response as follows:\n\n### Very Important Recommendations\n[Type] - [Specific recommendation]\nReason: [Reference to guideline ID and relevant section]\n\n### Somewhat Important Recommendations\n[Type] - [Specific recommendation]\nReason: [Reference to guideline ID and relevant section]\n\n### Less Important Recommendations\n[Type] - [Specific recommendation]\nReason: [Reference to guideline ID and relevant section]\n\n### Unimportant Recommendations\n[Type] - [Specific recommendation]\nReason: [Reference to guideline ID and relevant section]\n\nClinical Note:\n{{text}}\n\nGuideline:\n[ID] {{id}}\nTitle: {{title}}\nContent: {{content}}"
  },
  "filterRelevantPracticePoints": {
    "title": "Filter Relevant Practice Points",
    "description": "Used to filter practice points by relevance to a patient's clinical context",
    "system_prompt": "You are a clinical advisor. Return ONLY valid JSON - no markdown, no explanations.",
    "prompt": "CLINICAL NOTE:\n{{clinicalNote}}\n\nPRACTICE POINTS:\n{{pointsList}}\n\nFor each practice point, ask yourself: \"Does this practice point apply to this patient in their current situation?\"\n\nIf no (e.g., it's about a different phase of care, a condition they don't have, or circumstances that don't match), mark it as irrelevant.\n\nReturn JSON:\n{\n  \"relevant\": [1, 3, 6],\n  \"irrelevant\": {\n    \"4\": \"brief reason\",\n    \"7\": \"brief reason\"\n  }\n}"
  },
  "checkPracticePointCompliance": {
    "title": "Check Practice Point Compliance",
    "description": "Used to check if a clinical note is compliant with relevant practice points",
    "system_prompt": "You are a clinical advisor. Return ONLY valid JSON - no markdown, no explanations.",
    "prompt": "CLINICAL NOTE:\n{{clinicalNote}}\n\nPRACTICE POINTS:\n{{pointsList}}\n\nFor each practice point, ask yourself: \"Is this clinical note essentially compliant with this practice point?\"\n\nConsider the clinical intent, not just exact wording. If the note already addresses what the practice point recommends (even using different terminology), it's compliant.\n\nOnly mark as non-compliant if something genuinely valuable is missing.\n\nReturn JSON:\n{\n  \"compliant\": [1, 6],\n  \"nonCompliant\": [\n    {\n      \"index\": 10,\n      \"name\": \"Practice point name\",\n      \"issue\": \"What is genuinely missing\",\n      \"suggestion\": \"What additional action would add value\",\n      \"verbatimQuote\": \"Quote from practice point\"\n    }\n  ]\n}"
  },
  "expandPracticePoint": {
    "title": "Expand Practice Point",
    "description": "Used to expand a raw practice point into structured JSON with applicability criteria",
    "system_prompt": "You are a clinical guideline analyst. Return ONLY valid JSON. The description field MUST be structured applicability criteria with explicit APPLIES TO, NOT APPLICABLE, ACTION, and THRESHOLDS sections. This will be used by an LLM to determine if the practice point applies to a specific patient - be explicit about phase of care (antenatal vs postpartum), gestational age ranges, and exclusion criteria.",
    "prompt": "Given this SPECIFIC practice point from a clinical guideline:\n\n\"{{practicePoint}}\"\n{{guidelineSummary}}\nAnd the full guideline content below, create a structured JSON object for this practice point.\n\nReturn a JSON object with these fields:\n{\n  \"name\": \"Brief descriptive title (5-10 words)\",\n  \"description\": \"STRUCTURED APPLICABILITY CRITERIA - must include ALL of these:\\n• APPLIES TO: [specific patient population, phase of care (antenatal/intrapartum/postpartum), gestational age range, conditions]\\n• NOT APPLICABLE: [when this does NOT apply - different phase of care, exclusions, contraindications]\\n• ACTION: [what treatment/investigation/referral is recommended]\\n• THRESHOLDS: [any specific values, doses, or timing if applicable]\",\n  \"verbatimQuote\": \"The SPECIFIC sentence or phrase from the guideline that DIRECTLY states this practice point\",\n  \"significance\": \"high or medium or low\"\n}\n\nCRITICAL: The description field must be written as STRUCTURED APPLICABILITY CRITERIA, not as patient education.\n\nExample of GOOD description:\n\"APPLIES TO: Postpartum/postnatal women only (after delivery). NOT APPLICABLE: During pregnancy (antenatal period). ACTION: Continue iron supplements for 3-6 months after birth to replenish iron stores. THRESHOLDS: None specified.\"\n\nExample of BAD description (DO NOT write like this):\n\"This practice point involves continuing iron supplements for 3-6 months after giving birth to help replenish iron stores and prevent anemia. It's essential for women who have experienced blood loss...\"\n\nGuideline content:\n{{guidelineContent}}"
  },
  "analyzeGuidelineForPatient": {
    "title": "Analyze Guideline for Patient",
    "description": "Analyzes a clinical guideline semantically to identify actionable recommendations for a specific patient",
    "system_prompt": "You are a clinical advisor. Your job is to identify GAPS in care - things the guideline recommends that are genuinely NOT covered by the existing plan.\n\nCRITICAL: If the plan already includes monitoring, tests, follow-up, or treatment for a condition, do NOT suggest more of the same. Recognise clinical equivalence - 'FBC in labour' covers anaemia monitoring, 'serial USS' covers fetal monitoring, etc.\n\nReturn ONLY valid JSON - no markdown, no explanations.",
    "prompt": "CLINICAL NOTE:\n{{clinicalNote}}\n\nGUIDELINE TITLE: {{guidelineTitle}}\n\nGUIDELINE CONTENT:\n{{guidelineContent}}\n\nSTEP 1: Extract the existing plan from the clinical note. List EVERY planned action, test, referral, and follow-up.\n\nSTEP 2: For each guideline recommendation, ask: \"Is this ALREADY covered by something in the existing plan?\" Consider clinical equivalence:\n- If FBC/blood tests are planned → anaemia monitoring is covered\n- If USS monitoring is planned → fetal assessment is covered\n- If referral to specialist is planned → specialist input is covered\n- If follow-up is planned → ongoing care is covered\n\nSTEP 3: Only suggest things that are GENUINELY MISSING - not variations of what's already planned.\n\nReturn JSON:\n{\n  \"patientContext\": {\n    \"phaseOfCare\": \"e.g., Antenatal - 32+2 weeks gestation\",\n    \"keyConditions\": [\"condition1\", \"condition2\"],\n    \"existingPlan\": [\"EVERY planned action from the note - be thorough\"]\n  },\n  \"suggestions\": [\n    {\n      \"name\": \"Brief name of recommendation\",\n      \"issue\": \"What is GENUINELY missing - not already covered\",\n      \"why\": \"Detailed clinical reasoning determining specifically why this apply to this patient\",\n      \"suggestion\": \"Specific action to take\",\n      \"verbatimQuote\": \"Exact quote from the guideline supporting this\",\n      \"priority\": \"high or medium or low\",\n      \"notCoveredBy\": \"Explain why existing plan items do NOT cover this\"\n    }\n  ],\n  \"alreadyCompliant\": [\n    \"Guideline recommendation → covered by [specific plan item]\"\n  ]\n}\n\nIf the existing plan already covers all relevant recommendations, return an EMPTY suggestions array. It is better to suggest nothing than to suggest something redundant."
  },
  "evaluateSuggestions": {
    "title": "Evaluate Guideline Suggestions",
    "description": "Evaluates AI-generated suggestions against the full guideline for recall (coverage) and precision (appropriateness)",
    "system_prompt": "You are a clinical guideline expert evaluating AI-generated suggestions. Your task is to assess RECALL (did the AI surface all applicable recommendations?) and PRECISION (are the suggestions clinically appropriate and non-redundant?). Be rigorous but fair. Return ONLY valid JSON.",
    "prompt": "CLINICAL NOTE:\n{{clinicalNote}}\n\nGUIDELINE TITLE: {{guidelineTitle}}\n\nFULL GUIDELINE CONTENT:\n{{guidelineContent}}\n\nAI-GENERATED SUGGESTIONS:\n{{suggestions}}\n\nAI-IDENTIFIED AS ALREADY COMPLIANT:\n{{alreadyCompliant}}\n\nEvaluate the AI's output:\n\n1. RECALL (Coverage): Read the full guideline carefully. Are there any important recommendations that apply to this patient that the AI missed entirely? List them.\n\n2. PRECISION (Appropriateness): For each AI suggestion:\n   - Is it CORRECT (genuinely applicable and genuinely missing from the plan)?\n   - Is it INCORRECT (doesn't apply to this patient or phase of care)?\n   - Is it REDUNDANT (already covered by the existing plan)?\n\n3. FALSE NEGATIVES in alreadyCompliant: Did the AI incorrectly mark something as compliant when it should have been a suggestion?\n\nReturn JSON:\n{\n  \"recallScore\": 0.0-1.0,\n  \"precisionScore\": 0.0-1.0,\n  \"counts\": {\n    \"suggestionsTotal\": \"number of suggestions made by AI\",\n    \"correct\": \"number marked correct\",\n    \"incorrect\": \"number marked incorrect\",\n    \"redundant\": \"number marked redundant\",\n    \"missed\": \"number of missed recommendations\",\n    \"falseNegatives\": \"number of false negatives in alreadyCompliant\"\n  },\n  \"missedRecommendations\": [\n    {\n      \"recommendation\": \"What was missed\",\n      \"verbatimQuote\": \"Quote from guideline\",\n      \"whyImportant\": \"Why this matters for this patient\"\n    }\n  ],\n  \"suggestionEvaluations\": [\n    {\n      \"suggestionName\": \"Name of the AI suggestion\",\n      \"verdict\": \"correct|incorrect|redundant\",\n      \"explanation\": \"Why this verdict\"\n    }\n  ],\n  \"falseNegatives\": [\n    {\n      \"item\": \"Item marked as compliant\",\n      \"shouldBeSuggestion\": \"Why it should have been a suggestion\"\n    }\n  ],\n  \"overallAssessment\": \"Brief summary of AI performance on this scenario\"\n}"
  },
  "generatePromptImprovements": {
    "title": "Generate Prompt Improvements",
    "description": "Analyzes evaluation results across multiple scenarios to suggest prompt improvements",
    "system_prompt": "You are an expert at prompt engineering for clinical AI systems. Your task is to analyze patterns in AI failures across multiple test scenarios and suggest specific, actionable improvements to the prompts. Focus on GENERALIZABLE changes that will improve performance across diverse scenarios - avoid overfitting to specific cases. Return ONLY valid JSON.",
    "prompt": "CURRENT PROMPT BEING EVALUATED:\n{{currentPrompt}}\n\nEVALUATION RESULTS ACROSS {{scenarioCount}} SCENARIOS:\n{{evaluationResults}}\n\nAGGREGATED METRICS:\n- Average Recall: {{avgRecall}}\n- Average Precision: {{avgPrecision}}\n- Average Latency: {{avgLatency}}ms\n- Average Redundancy Rate: {{avgRedundancyRate}}\n- Average False Negative Rate: {{avgFalseNegativeRate}}\n\nCOMMON FAILURE PATTERNS:\n{{failurePatterns}}\n\nAnalyze the evaluation results and suggest improvements to the prompt. Focus on:\n\n1. PATTERNS: What types of errors occur repeatedly across scenarios?\n2. ROOT CAUSES: Why is the current prompt leading to these errors?\n3. IMPROVEMENTS: What specific changes would address these patterns?\n\nIMPORTANT: Suggest GENERALIZABLE improvements, not fixes for specific scenarios. The goal is evolutionary improvement that works across diverse clinical situations.\n\nReturn JSON:\n{\n  \"analysis\": {\n    \"keyPatterns\": [\"Pattern 1\", \"Pattern 2\"],\n    \"rootCauses\": [\"Cause 1\", \"Cause 2\"],\n    \"strengthsToPreserve\": [\"What the prompt does well\"]\n  },\n  \"suggestedChanges\": [\n    {\n      \"section\": \"system_prompt|prompt\",\n      \"changeType\": \"add|modify|remove\",\n      \"currentText\": \"The text to change (if modify/remove)\",\n      \"newText\": \"The new/replacement text\",\n      \"rationale\": \"Why this change will help\",\n      \"expectedImpact\": \"recall|precision|both\"\n    }\n  ],\n  \"newSystemPrompt\": \"Complete revised system prompt (if changes suggested)\",\n  \"newPrompt\": \"Complete revised prompt (if changes suggested)\",\n  \"expectedImprovement\": {\n    \"recall\": \"+X% expected\",\n    \"precision\": \"+X% expected\",\n    \"tradeoffs\": \"Any potential downsides\"\n  },\n  \"testingRecommendation\": \"How to validate these changes\"\n}"
  }
}